# OWMS 시스템 표준 가이드라인 (Standard Conventions)

본 문서는 OWMS 백엔드 및 프론트엔드 개발 시 일관성을 유지하기 위해 준수해야 할 기술 표준과 약속을 기술합니다.

## 1. 날짜 및 시간 처리 (Date & Time)
모든 날짜 처리는 **KST (Korea Standard Time, UTC+9)** 기준을 표준으로 하며, 파편화된 로직 대신 `DateUtil`을 사용합니다.

- **유틸리티**: `src/common/utils/date.util.ts`
- **주요 원칙**:
  - 날짜 조회 범위 설정 시 반드시 `setStartOfDay()`와 `setEndOfDay()`를 사용하여 경계값을 명확히 합니다.
  - DB 저장 및 비교 시 타임존 오차를 방지하기 위해 `toKSTString()` 등을 활용합니다.
  - 주간 데이터의 기준점은 항상 월요일(`getMonday()`)로 통일합니다.

## 2. ID 및 데이터 매핑 체계
데이터베이스의 일련번호(ID) 외에 로직상 필요한 가상 ID나 매직 넘버 사용을 지양합니다.

- **미지정 데이터 처리**: 
  - 팀이 없는 부서 사용자의 경우 가상 ID(10000+ID) 대신 **`teamId: 0`** (또는 명시적 null)을 반환합니다.
  - 프론트엔드는 `teamId === 0`일 때 '미지정' 또는 '부서 전체' 카드로 렌더링하도록 약속합니다.
- **프로젝트 ID**: 시스템 내부 업무는 `projectId: null`로 관리하며, 외부 프로젝트만 정수 ID를 할당합니다.

## 3. CRUD 및 데이터 무결성 패턴
데이터의 고유성(Identity)을 보존하고 관계가 깨지는 것을 방지합니다.

- **업데이트 전략**: 
  - `deleteMany` 후 `create`하는 파괴적 갱신을 금지합니다.
  - 기존 데이터의 `id`를 유지할 수 있도록 **`upsert`** 또는 **`update/create`** 분기 로직을 사용합니다.
- **관계 설정 (Prisma)**:
  - 새로운 모델 추가 시 반드시 역관계(Back-relation)를 설정하여 유기적인 `include` 조회가 가능하도록 합니다.

## 4. 환경 설정 및 보안
보안 민감 정보와 환경 의존적 경로는 코드에 노출하지 않습니다.

- **비밀키 관리**: JWT Secret, Refresh Secret 등은 반드시 `.env`에서 로드합니다.
- **파일 경로**: 엑셀 템플릿 등 서버 환경에 종속적인 경로는 환경 변수(`EXCEL_TEMPLATE_PATH`)를 사용합니다.

## 5. API 응답 일관성
- **민감 정보 제외**: `password`, `refreshToken` 등 보안 정보는 서비스 레이어에서 항상 `select` 또는 구조 분해 할당을 통해 제외하고 반환합니다.
- **Role 기반 접근**: 5단계 권한(`CEO`, `EXECUTIVE`, `DEPT_HEAD`, `TEAM_LEADER`, `MEMBER`)에 따른 데이터 필터링 로직을 서비스 도입부에 명시합니다.

---
> [!IMPORTANT]
> 신규 기능을 추가하거나 기존 로직을 수정할 때 본 가이드라인에서 벗어나는 경우, 반드시 팀과 협의 후 문서를 먼저 갱신해야 합니다.
