# OWMS 개발 규범 및 타임존 처리 가이드

본 문서는 OWMS(Office Work Management System) 프로젝트의 개발 일관성을 유지하고, 특히 서버(UTC)와 한국 시간(KST) 간의 차이로 발생하는 데이터 오류를 방지하기 위한 규칙을 정의합니다.

---

## 1. 타임존 처리 원칙 (Timezone Handling)

모든 날짜 및 시간 데이터는 **한국 표준시(KST, UTC+9)**를 기준으로 처리하는 것을 원칙으로 합니다.

### 1-1. 백엔드 (Backend)
- **날짜 비교**: DB에서 가져온 `Date` 객체를 날짜 문자열(`YYYY-MM-DD`)로 변환하여 비교할 때는 반드시 KST 오프셋(+9시간)을 적용해야 합니다.
  - ❌ `date.toISOString().split('T')[0]` (UTC 기준이므로 한국 오전 9시 이전 데이터는 전날로 처리됨)
  - ✅ 오프셋 적용 헬퍼 사용:
    ```typescript
    const toKSTString = (d: Date) => {
      const kstDate = new Date(d.getTime() + (9 * 60 * 60 * 1000));
      return kstDate.toISOString().split('T')[0];
    };
    ```
- **조회 범위**: 날짜 필터링 시에는 타임존 경계 문제를 방지하기 위해 조회 대상 기간의 전후로 넉넉하게(최소 ±1일) 범위를 설정하여 데이터를 가져온 후 로직에서 필터링하는 것을 권장합니다.

### 1-2. 프론트엔드 (Frontend)
- **날짜 입력**: `input[type="date"]`에서 넘어오는 값은 이미 현지 시간 기준의 `YYYY-MM-DD` 문자열이므로 그대로 사용합니다.
- **날짜 표시**: 서버로부터 받은 날짜 데이터를 화면에 표시할 때는 브라우저의 로케일을 따르거나, 백엔드와 동일하게 KST 기준으로 포맷팅합니다.

---

## 2. 주간 업무 현황 그룹화 규칙 (Weekly Status Grouping)

사용자 소속에 따른 현황 카드 노출 우선순위입니다.

1. **팀이 존재하는 부서**: 부서 전체 카드는 노출하지 않고, **개별 팀 단위**의 카드만 노출합니다. (예: 솔루션사업부 -> 솔루션개발팀, TF사업팀 카드 노출)
2. **팀이 없는 부서**: **부서 이름**으로 하나의 통합 카드를 노출합니다. (예: 경영지원부 -> 경영지원부 카드 노출)
3. **권한별 노출**:
   - `CEO`, `EXECUTIVE`: 모든 부서/팀 노출.
   - `LEADER`, `MEMBER`: 본인 소속 부서 내의 카드들만 노출.

---

## 3. 코드 작성 규범

- **주석**: 모든 주석은 **한글**로 작성합니다.
- **명칭**: '휴가'라는 표현 대신 **'연차'**를 공식 용어로 사용합니다.
- **데이터 정합성**: 반차(오전/오후) 신청 시에는 시작일과 종료일을 동일한 날짜로 서버에 전송하여 데이터 일관성을 유지합니다.

---

> [!IMPORTANT]
> 새로운 업무 로직을 추가하거나 날짜 기반의 통계를 작성할 때는 반드시 위의 `toKSTString` 방식의 타임존 보정이 적용되었는지 확인하십시오.
